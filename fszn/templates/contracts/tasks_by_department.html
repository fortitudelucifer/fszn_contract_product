{% extends 'base.html' %}

{% block title %}按部门查看任务{% endblock %}

{% block content %}
<h1>按部门查看任务</h1>

{{ super() }}

<p>
    <a href="{{ url_for('contracts.list_contracts') }}">返回项目列表</a> |
    <a href="{{ url_for('contracts.tasks_by_department') }}">按部门</a> |
    <a href="{{ url_for('contracts.tasks_by_person') }}">按人员</a>
</p>

{% for d in departments %}
<h2>{{ d.name }}</h2>

    {% set dept_tasks = tasks_by_dept.get(d.id, []) %}
    {% if dept_tasks %}
<p>任务数量：{{ dept_tasks|length }}</p>
<table border="1" cellpadding="4" cellspacing="0">
    <thead>
        <tr>
            <th>项目编号</th>
            <th>合同名称</th>
            <th>任务ID</th>
            <th>任务名称</th>
            <th>负责人</th>
            <th>开始日期</th>
            <th>完成日期</th>
            <th>状态</th>
            <th>备注</th>
        </tr>
    </thead>
    <tbody>
        {% for t in dept_tasks %}
        <tr>
            <td>{{ t.contract.project_code if t.contract else '' }}</td>
            <td>{{ t.contract.name if t.contract else '' }}</td>
            <td>{{ t.id }}</td>
            <td>{{ t.title }}</td>
            <td>{{ t.person.name if t.person else '' }}</td>
            <td>{{ t.start_date }}</td>
            <td>{{ t.end_date or '' }}</td>
            <td>{{ t.status }}</td>
            <td>{{ t.remarks }}</td>
        </tr>
        {% endfor %}
    </tbody>
</table>
    {% else %}
<p>当前部门还没有任何任务。</p>
    {% endif %}
{% endfor %}

{% endblock %}
